<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on https://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/bootstrap.min.css">
  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="stylesheets/github-dark.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/External%20Javascript/detectSpeed.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/External%20Javascript/jquery-1.11.3.js"></script>
  <script src="javascripts/bootstrap.min.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/StaticInformation.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/NetworkUtilities.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/NetworkInformation.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/SpeedTest.js"></script>
  <script src="https://rawgit.com/Michotastico/NetworkInformationJS/master/Heimdal.js"></script>
  <script src="http://maps.google.com/maps/api/js"></script>

  <title>NetworkInformationJS</title>
  <meta name="description" content="JS Library to check Network information in front-to-end">

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script>
  const file_international = "http://michotastico.github.io/assets/images/space.jpg";
  const file_national = "http://users.dcc.uchile.cl/~mllorens/Niclabs/adkintun.php";
  var heimdal = new Heimdal('http://127.0.0.1:5000/echo');
  heimdal.init(geolocation);


  function map(lat,lon){
    latlon = new google.maps.LatLng(lat, lon)
    mapholder = document.getElementById('mapholder')
    mapholder.style.height = '250px';
    mapholder.style.width = '500px';

    var myOptions = {
      center:latlon,zoom:14,
      mapTypeId:google.maps.MapTypeId.ROADMAP,
      mapTypeControl:false,
      navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
    }

    var map = new google.maps.Map(document.getElementById("mapholder"), myOptions);
    var marker = new google.maps.Marker({position:latlon,map:map,title:"You are here!"});
  }

  function write(where, what){
    document.getElementById(where).innerHTML = document.getElementById(where).innerHTML + what;
  }

  function loadingbar(_where, _loc, percentage){
    var bar_percentage = Math.floor(percentage);
    $('.progress-bar').css('width', percentage+'%');
    var result_place = _where
    if(bar_percentage == 100){
      setTimeout(function () {
        var where = result_place;
        var arr = heimdal.getSpeedTests();
        var nijs = arr[arr.length - 1];
        document.getElementById('header').style.visibility = 'hidden';
        document.getElementById('progress_bar').style.visibility = 'hidden';
        $('.progress-bar').css('width','0%');
        document.getElementById(_loc).innerHTML = "Resultados de la conexión " + _loc;
        write(where,"\nEl proceso demoró " + nijs.getTestTime() + " dando así una velocidad de bajada de " + nijs.getDownloadSpeed() + " Mbps");
        write(where,"\nLatencia : " + nijs.getLatency());
        write(where,"\nLa latencia es equivalente a una conexión del tipo: " + nijs.getLatencyType());
        write(where,"\nThroughput : " + nijs.getThroughput());
        write(where,"\nThroughPut equivalente a una conexión del tipo : " + nijs.getThroughputType());
      }, 1000);

    }
  }

  function geolocation(){
    var nijs = heimdal.getNetworkInfo();
    var success = nijs.isSuccessful();
    var table_body = ""
    var proxy = "Falso";
    if(nijs.useProxy()){
      proxy = "Verdadero";
    }
    if(success){
      table_body += "<tr><td> AS </td><td><b>" + nijs.getAS() + "</b></td></tr>"
      table_body += "<tr><td> Sistema Operativo </td><td><b>" + nijs.getOS() + "</b></td></tr>"
      table_body += "<tr><td> Proxy </td><td><b>" + proxy + "</b></td></tr>"
      table_body += "<tr><td> País </td><td><b>" + nijs.getCountry() + "</b></td></tr>"
      table_body += "<tr><td> Region </td><td><b>" + nijs.getRegionName() + "</b></td></tr>"
      table_body += "<tr><td> Ciudad </td><td><b>" + nijs.getCity() + "</b></td></tr>"
      table_body += "<tr><td> ISP </td><td><b>" + nijs.getIsp() + "</b></td></tr>"
      table_body += "<tr><td> IP </td><td><b>" + nijs.getIp() + "</b></td></tr>"
      table_body += "<tr><td> Zona horaria </td><td><b>" + nijs.getTimezone() + "</b></td></tr>"
    }
    else{
      table_body += "<tr><td> Estado conexión </td><td><b> Fallida </b></td></tr>"
    }
    $("#GeoResults").html(table_body);
    var coords = nijs.getCoordinates();
    map(coords[0], coords[1]);
  }

  </script>

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">JS Network Information</h1>
    </header>
    <div id="container">
      <p class="tagline">Library in Javascript to check the network information of the client, including his download speed. The JSDoc is available <a href = "http://michotastico.github.io/NetworkInformationJS/JSDoc/">here.</a></p>
      <div id="main" role="main">
        <div class="download-bar">
          <div class="inner">
            <a href="https://github.com/Michotastico/NetworkInformationJS/tarball/master" class="download-button tar"><span>Download</span></a>
            <a href="https://github.com/Michotastico/NetworkInformationJS/zipball/master" class="download-button zip"><span>Download</span></a>
            <a href="https://github.com/Michotastico/NetworkInformationJS" class="code">View Networkinformationjs on GitHub</a>
          </div>
          <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>
            <a id="networkinformationjs" class="anchor" href="#networkinformationjs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Información de conexión</h1>


            <center><div id="mapholder"></div></center>
            <table id="GeoResults"></table>
            <center><p>Se utilizará un archivo de ~20MB para comprobar la velocidad de bajada.</p></center>
            <center>
              <input id="speed_button_national" type="button" value="Iniciar Test Nacional" onClick="speedTestNational();">
              <input id="speed_button_international" type="button" value="Iniciar Test Internacional" onClick="speedTestInternational();">
            </center>
            <h1 id="header"></h1>
            <div class="progress" id="progress_bar" style="visibility: hidden">
              <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"
              aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:0%" >
            </div>
          </div>
          <h1 id="Nacional"></h1>
          <pre id="National_Result" style="visibility: hidden"></pre>
          <h1 id="Internacional"></h1>
          <pre id="International_Result" style="visibility: hidden"></pre>
          <center>
            <input id="json_button" type="button" value="Mostrar JSON" onClick="showJSON();">
            <h1 id="JSON"></h1>
          </center>
          <pre id="JSON_display" style="visibility: hidden"></pre>
          <script>
          function speedTestInternational(){
            document.getElementById('header').innerHTML = "Iniciando detección\n";
            document.getElementById('header').style.visibility = 'visible';
            document.getElementById('speed_button_international').disabled = true;
            document.getElementById('speed_button_international').value = "Test internacional realizado";
            document.getElementById('progress_bar').style.visibility = 'visible';
            document.getElementById('International_Result').style.visibility = 'visible';
            var onprogress = function c(evt){
              if (evt.lengthComputable)
              {
                var percentComplete = (evt.loaded / evt.total)*100;
                loadingbar("International_Result", "Internacional", percentComplete);
              }
            }
            heimdal.runTest(onprogress,file_international);
          }
          function speedTestNational(){
            document.getElementById('header').innerHTML = "Iniciando detección\n";
            document.getElementById('header').style.visibility = 'visible';
            document.getElementById('speed_button_national').disabled = true;
            document.getElementById('speed_button_national').value = "Test nacional realizado";
            document.getElementById('progress_bar').style.visibility = 'visible';
            document.getElementById('National_Result').style.visibility = 'visible';
            var onprogress = function c(evt){
              if (evt.lengthComputable)
              {
                var percentComplete = (evt.loaded / evt.total)*100;
                loadingbar("National_Result", "Nacional", percentComplete);
              }
            }
            heimdal.runTest(onprogress, file_national);
          }

          function showJSON(){
            var json = JSON.stringify(heimdal, null, 4);
            document.getElementById('JSON').innerHTML = "JSON";
            document.getElementById('JSON_display').innerHTML = json;
            document.getElementById('JSON_display').style.visibility = 'visible';
            document.getElementById('json_button').value = "Actualizar JSON";
          }
          </script>

          <p>Created by <a href="https://github.com/Michotastico" class="user-mention">@Michotastico</a></p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
        <p><a href="https://github.com/Michotastico" class="avatar"><img src="https://avatars3.githubusercontent.com/u/11854074?v=3&amp;s=60" width="48" height="48"></a> <a href="https://github.com/Michotastico">Michotastico</a> maintains <a href="https://github.com/Michotastico/NetworkInformationJS">Networkinformationjs</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/Michotastico/NetworkInformationJS/tarball/master" class="tar">tar</a><a href="https://github.com/Michotastico/NetworkInformationJS/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>


</body>
</html>
